version: '3.8'

services:
  gaia-dev:
    build:
      context: .
      dockerfile: Dockerfile
    image: itomek/gaia-dev:latest
    container_name: ${CONTAINER_NAME:-gaia-dev}
    hostname: gaia-dev

    # Port mappings for GAIA services
    ports:
      - "${LEMONADE_PORT:-5000}:5000"  # Lemonade LLM server
      - "${GAIA_API_PORT:-8000}:8000"  # GAIA API server
      - "${WEB_PORT:-3000}:3000"       # Web applications

    # Environment configuration
    environment:
      # Required: GitHub token for cloning
      - GITHUB_TOKEN=${GITHUB_TOKEN:?GITHUB_TOKEN is required}

      # Optional: GAIA source configuration
      - GAIA_BRANCH=${GAIA_BRANCH:-main}
      - GAIA_REPO=${GAIA_REPO:-https://github.com/amd/gaia.git}

      # Optional: Skip pip install (for faster restarts)
      - SKIP_INSTALL=${SKIP_INSTALL:-false}

      # Optional: Remote Lemonade server
      - LEMONADE_URL=${LEMONADE_URL:-}

    # Volume mounts
    volumes:
      # Persist Claude Code config and credentials
      - gaia-claude-config:/home/gaia/.claude

      # Optional: Mount host directory for file exchange
      # Set HOST_DIR environment variable to enable
      ${HOST_DIR:+- "${HOST_DIR}:/host"}

    # Keep container running
    tty: true
    stdin_open: true

    # Resource limits (adjust as needed)
    deploy:
      resources:
        limits:
          cpus: '4'
          memory: 8G

# Named volumes for persistent data
volumes:
  gaia-claude-config:
    name: ${CONTAINER_NAME:-gaia-dev}-claude-config
